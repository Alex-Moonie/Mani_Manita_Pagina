<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mensaje Secreto Mani_Manita</title>
    <link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        @keyframes gradient-animation { 0% { background-position: 0% 50%; } 100% { background-position: 0% 50%; } }
        body { font-family: 'Gochi Hand', cursive, sans-serif; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; margin: 0; background: linear-gradient(-45deg, #ffccf9, #c4fff9, #a7f7be, #c0b3ff, #f7e6a7); background-size: 400% 400%; animation: gradient-animation 20s ease infinite; padding: 20px; overflow-x: hidden; }
        .card-container { background-color: white; padding: 30px 40px; border-radius: 30px; box-shadow: 0 15px 35px rgba(255, 110, 140, 0.4); max-width: 90%; width: 700px; animation: bounceIn 1s ease-out; border: 5px solid #ff99cc; position: relative; z-index: 10; }
        .logo { width: 90px; height: auto; margin-bottom: 10px; border: 4px solid #FFD700; border-radius: 50%; box-shadow: 0 0 15px 5px rgba(255, 215, 0, 0.6); animation: pulse 2s infinite ease-in-out; }
        h1 { color: #ff6e8c; font-size: 2.2em; margin-top: 5px; margin-bottom: 20px; text-shadow: 2px 2px 0 #fff3e0; font-family: 'Patrick Hand', cursive; text-align: center; }
        #output-area { display: flex; flex-wrap: wrap; justify-content: center; align-items: flex-end; min-height: 100px; padding: 15px; background-color: #fce4ec; border: 3px dashed #ff99cc; border-radius: 15px; margin-bottom: 20px; overflow-x: auto; }
        .sign-output-image { width: 60px; height: 60px; margin: 5px; border: 2px solid #ff99cc; border-radius: 8px; background-color: white; }
        .output-space { width: 25px; height: 100%; display: inline-block; }
        #mensaje-texto { font-family: 'Gochi Hand', cursive; font-size: 1.5em; color: #666; line-height: 1.3; padding: 10px 0; text-align: center; border-top: 1px solid #ccc; margin-top: 15px; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes bounceIn { 0% { transform: scale(0.8); opacity: 0; } 60% { transform: scale(1.05); opacity: 1; } 100% { transform: scale(1); } }
    </style>
</head>
<body>
    <div class="card-container">
       
        <img src="https://alex-moonie.github.io/ManiManita-Fotos/logo.png" alt="Logo Mani_Manita" class="logo">
       
        <h1>¡Un Mensajito para ti!</h1>
       
        <div id="output-area"></div>

        <p id="mensaje-texto">Cargando mensaje...</p>
       
    </div>

    <script>
        
        const GITHUB_PAGES_URL = 'https://alex-moonie.github.io/ManiManita-Fotos/';
        
        const SIGN_MAP = {
            'A': 'LetraA', 'B': 'LetraB', 'C': 'LetraC', 'D': 'LetraD', 'E': 'LetraE',
            'F': 'LetraF', 'G': 'LetraG', 'H': 'LetraH', 'I': 'LetraI', 'J': 'LetraJ',
            'K': 'LetraK', 'L': 'LetraL', 'LL': 'LetraLL', 'M': 'LetraM', 'N': 'LetraN',
            'Ñ': 'LetraÑ', 'O': 'LetraO', 'P': 'LetraP', 'Q': 'LetraQ', 'R': 'LetraR',
            'RR': 'LetraRR', 'S': 'LetraS', 'T': 'LetraT', 'U': 'LetraU', 'V': 'LetraV',
            'W': 'LetraW', 'X': 'LetraX', 'Y': 'LetraY', 'Z': 'LetraZ',

            // NÚMEROS CONCEPTO (se mapean a los dígitos del archivo .png)
            'CERO': '0', 'UNO': '1', 'DOS': '2', 'TRES': '3', 'CUATRO': '4',
            'CINCO': '5', 'SEIS': '6', 'SIETE': '7', 'OCHO': '8', 'NUEVE': '9', 'DIEZ': '10',
            
            // DÍGITOS NUMÉRICOS (para deletreo)
            '0': '0', '1': '1', '2': '2', '3': '3', '4': '4', '5': '5',
            '6': '6', '7': '7', '8': '8', '9': '9',
            '10': '10', 

            'HOLA': 'hola', 'AYUDA': 'ayuda', 'NOMBRE': 'nombre',
            'COMER': 'comer', 'BEBER': 'beber', 'BAÑO': 'baño', 'ESPERA': 'esperar',
            'GRACIAS': 'GRACIAS', 'BIEN': 'BIEN', 'MAL': 'MAL',

            '¿CÓMO?': 'COMO', '¿QUIÉN?': 'QUIEN', '¿QUÉ?': 'QUE',
            '¿CUÁNDO?': 'CUANDO', '¿DÓNDE?': 'DONDE', '¿POR QUÉ?': 'por que'
        };

        function normalizeTextForMatching(text) {
            return text
                .toUpperCase()
                .normalize("NFD").replace(/[\u0300-\u036f]/g, "") 
                .replace(/[¿?.,!]/g, '') 
                .trim();
        }

        // FUNCIÓN CORREGIDA FINAL para manejar las extensiones de imagen correctamente
        function appendLetter(letter) {
            const outputArea = document.getElementById('output-area');
            const img = document.createElement('img');
            let fileName = SIGN_MAP[letter]; 
            let extension = '.png'; // Por defecto es .png (para números y conceptos)

            if (!fileName) {
                console.error(`ERROR: No se encontró el mapeo para ${letter}`);
                return;
            }

            // Lógica Específica: Si el nombre del archivo empieza con 'Letra', la extensión DEBE ser .jpg
            if (fileName.startsWith('Letra')) {
                extension = '.jpg'; // <-- Fuerza las letras a buscarse como LetraA.jpg
            }
            // Si no empieza con 'Letra', se queda con la extensión por defecto: .png (para 1.png, hola.png, etc.)
            
            let imageSrc = GITHUB_PAGES_URL + fileName + extension;
            
            img.onerror = function() {
                console.error(`ERROR DE CARGA: No se encontró la imagen para ${letter}. URL intentada: ${imageSrc}.`);
            };

            img.src = imageSrc;
            img.alt = `Seña ${letter}`;
            img.classList.add('sign-output-image');
            outputArea.appendChild(img);
        }

        function convertTextToSigns(text) {
            const outputArea = document.getElementById('output-area');
            outputArea.innerHTML = '';
            if (!text) return;

            // Definiciones necesarias para el funcionamiento
            const normalizedSignMap = {};
            const allSignMapKeys = Object.keys(SIGN_MAP);
            for (const key of allSignMapKeys) {
                normalizedSignMap[normalizeTextForMatching(key)] = key; 
            }
            
            const specialPhrases = { 'POR QUE': '¿POR QUÉ?' };

            const rawWords = text.split(/\s+/).filter(word => word.length > 0);
            const normalizedWords = rawWords.map(word => normalizeTextForMatching(word));

            let i = 0;
            while (i < rawWords.length) {
                let matchedKey = null;
                let matchedWordCount = 0;
                const originalWord = rawWords[i]; 

                // 1. Búsqueda de frases especiales (como 'POR QUE' -> '¿POR QUÉ?')
                for (const normalizedPhrase in specialPhrases) {
                    const phraseWords = normalizedPhrase.split(' ');
                    if (i + phraseWords.length <= normalizedWords.length) {
                        const currentPhraseSlice = normalizedWords.slice(i, i + phraseWords.length).join(' ');
                        if (currentPhraseSlice === normalizedPhrase) {
                            matchedKey = specialPhrases[normalizedPhrase];
                            matchedWordCount = phraseWords.length;
                            break;
                        }
                    }
                }
                
                // 2. Búsqueda de conceptos o palabras completas
                if (!matchedKey) {
                    const normalizedWord = normalizedWords[i];
                    
                    if (normalizedWord in normalizedSignMap) {
                        matchedKey = normalizedSignMap[normalizedWord];
                        matchedWordCount = 1;
                    }
                    
                    if (!matchedKey && originalWord in SIGN_MAP) {
                        matchedKey = originalWord;
                        matchedWordCount = 1;
                    }
                }

                // 3. Renderizar imagen si se encontró un match
                if (matchedKey) {
                    appendLetter(matchedKey);
                    i += matchedWordCount;
                } else {
                    // 4. Deletreo (Dactilología) si no hay match
                    const wordForFingerspelling = originalWord.toUpperCase().replace(/[¿?.,!]/g, ''); 

                    for (let j = 0; j < wordForFingerspelling.length; j++) {
                        let char = wordForFingerspelling[j];
                        let key = '';

                        const twoChars = wordForFingerspelling.substring(j, j + 2);
                        // Prioriza LL y RR
                        if (allSignMapKeys.includes(twoChars) && (twoChars === 'LL' || twoChars === 'RR')) {
                            key = twoChars;
                            j++;
                        } else if (allSignMapKeys.includes(char)) {
                            key = char;
                        }

                        if (key) {
                            appendLetter(key);
                        }
                    }
                    i++;
                }

                // Añadir espacio después de cada palabra (si no es la última)
                if (i < rawWords.length) {
                    const spaceDiv = document.createElement('div');
                    spaceDiv.classList.add('output-space');
                    outputArea.appendChild(spaceDiv);
                }
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            let mensajeCodificado = urlParams.get('m');
            let mensajeElement = document.getElementById('mensaje-texto');
            
            let mensajeMostrar = "Error: No se encontró un mensaje válido.";

            if (mensajeCodificado) {
                try {
                    mensajeMostrar = decodeURIComponent(mensajeCodificado);
                    mensajeMostrar = mensajeMostrar.replace(/\+/g,' ');
                    
                    convertTextToSigns(mensajeMostrar);

                } catch (e) {
                    mensajeMostrar = "Error al leer el mensaje. El código es inválido.";
                }
            }
            
            mensajeElement.textContent = mensajeMostrar;
        });
    </script>
</body>
</html>
